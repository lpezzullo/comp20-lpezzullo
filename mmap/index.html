<!DOCTYPE html>
<html>
<head>
	<title>The Real Marauder's Map</title>
	<link rel="stylesheet" href="style.css" />
	<script src="http://maps.google.com/maps/api/js?sensor=true"></script>
		<script>
			var xhr;
			function getData() {
				var myLat = 0;
				var myLng = 0;
				navigator.geolocation.getCurrentPosition(function(position) {
					console.log("2. Finally got your location!");
					myLat = position.coords.latitude;
					myLng = position.coords.longitude;
					xhr = new XMLHttpRequest();
					xhr.open("post", "https://secret-about-box.herokuapp.com/sendLocation", true);
					xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
					xhr.onreadystatechange = dataReady;
					xhr.send("login=RoyMcFatter&lat=" + myLat + "&lng=" + myLng);
					});
				
			}

			function dataReady() {
				console.log("Ready state changed to" + xhr.readyState);
				if (xhr.readyState == 4 && xhr.status == 200) {
					console.log("Got data!");
					var data = JSON.parse(xhr.responseText);
					for(var x in data) {
						console.log(data[i].login);
					}
//					document.getElementById("map-canvas").innerHTML += JSON.parse(xhr.responseText);
				}
				else if (xhr.readyState == 4 && xhr.status == 500) {
					console.log("Error 500");
				}
			}

			function parseResponse() {

			}
/*			function solemnlySwear() {
				var myLat = 0;
				var myLng = 0;
				
				console.log("1. In getMyLocation()");
				if (navigator.geolocation) { 
					navigator.geolocation.getCurrentPosition(function(position) {
							console.log("2. Finally got your location!");
							myLat = position.coords.latitude;
							myLng = position.coords.longitude;
							drawMap(myLat,myLng);
							console.log("Lat = " + myLat + ", Long = " + myLng);
							console.log("3. Leaving the function(position)...");
						});
				}
				else {
					alert("Geolocation is not supported by your web browser.  What a shame!");
				}
				console.log("4. Leaving getMyLocation(). Good bye cruel world!");
				
			}

			function drawMap(myLat, myLng)
			{
				console.log("Executing drawMap()");
				// My Location
				var landmark = new google.maps.LatLng(myLat,myLng);
			
				// Set up map
				var myOptions = {
					zoom: 13,
					center: landmark,
					mapTypeId: google.maps.MapTypeId.ROADMAP
				};
				
				// Create the map in the "map_canvas" <div>
				var map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
				// dropMarker(landmark);
				var birdIcon = new Image();
				birdIcon.src = "me2.jpg";
				birdIcon.addEventListener("load", function() {
					// Create a marker			
					var marker = new google.maps.Marker({
						position: landmark,
						title: "You are here!",
						icon: birdIcon.src
					});
					marker.setMap(map);

					// This is a global info window...
					var infowindow = new google.maps.InfoWindow();
					
					// Open info window on click of marker
					google.maps.event.addListener(marker, 'click', function() {
						infowindow.setContent(marker.title);
						infowindow.open(map, marker);
						});
				}, false);
			}
			*/
		</script>
	</head>
	<body onload = "getData()">
		<div id = "map-canvas">Getting your location...</div>
	</body>
</html>